<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSU CGPA Calculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }
        .header h1 { font-size: 28px; margin-bottom: 10px; }
        .header p { font-size: 14px; opacity: 0.9; }
        .nav-buttons {
            position: absolute;
            top: 30px;
            right: 30px;
            display: flex;
            gap: 10px;
        }
        .nav-btn {
            padding: 10px 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            text-decoration: none;
        }
        .nav-btn:hover { background: white; color: #667eea; }
        .nav-btn.active { background: white; color: #667eea; }
        .cgpa-display {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 30px;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
        }
        .cgpa-box { flex: 1; min-width: 150px; text-align: center; }
        .cgpa-box label { display: block; color: white; font-size: 14px; margin-bottom: 5px; opacity: 0.9; }
        .cgpa-box .value { font-size: 48px; font-weight: bold; color: white; }
        .content { padding: 30px; }
        .info-box {
            background: #edf2f7;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        .info-box p { color: #4a5568; font-size: 14px; line-height: 1.6; }
        
        .pdf-upload-section {
            background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            text-align: center;
        }
        .pdf-upload-section h2 { color: #333; margin-bottom: 15px; font-size: 22px; }
        .pdf-upload-section p { color: #555; margin-bottom: 20px; font-size: 14px; }
        .upload-area {
            background: white;
            border: 3px dashed #667eea;
            border-radius: 10px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .upload-area:hover { border-color: #764ba2; background: #f8f9ff; }
        .upload-icon { font-size: 50px; margin-bottom: 15px; }
        .upload-text { color: #667eea; font-size: 16px; font-weight: 600; margin-bottom: 8px; }
        .upload-subtext { color: #888; font-size: 13px; }
        #pdfInput { display: none; }
        
        .form-section { margin-bottom: 30px; }
        .form-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        thead { background: #667eea; color: white; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { font-weight: 600; }
        tbody tr:hover { background: #f8f9ff; }
        input[type="text"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-add { background: #48bb78; color: white; }
        .btn-add:hover { background: #38a169; }
        .btn-remove { background: #f56565; color: white; padding: 6px 12px; }
        .btn-remove:hover { background: #e53e3e; }
        .btn-clear { background: #fc8181; color: white; }
        .btn-clear:hover { background: #f56565; }
        .btn-analyze-link {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        .btn-analyze-link:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4); }
        .buttons { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        .cta-box {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            margin-top: 30px;
        }
        .cta-box h3 { font-size: 22px; margin-bottom: 10px; }
        .cta-box p { margin-bottom: 20px; opacity: 0.95; }
        .grading-table { margin-top: 30px; }
        .grading-table h2 { color: #333; margin-bottom: 15px; }
        .grading-table table { background: #f7fafc; }
        .grading-table thead { background: #4a5568; }
        .grade-label { font-weight: bold; color: #667eea; }
        .footer { background: #2d3748; color: white; text-align: center; padding: 15px; font-size: 13px; }
        @media (max-width: 768px) {
            .nav-buttons { position: static; justify-content: center; margin-top: 15px; }
            .cgpa-box .value { font-size: 36px; }
            table { font-size: 12px; }
            th, td { padding: 8px 4px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="nav-buttons">
                <a href="calculator.html" class="nav-btn active">Calculator</a>
                <a href="analyzer.html" class="nav-btn">Analyzer</a>
            </div>
            <h1>NSU CGPA Calculator</h1>
            <p>Followed by North South University Grading Policy</p>
        </div>

        <div class="cgpa-display">
            <div class="cgpa-box">
                <label>CGPA</label>
                <div class="value" id="cgpaValue">0.00</div>
            </div>
            <div class="cgpa-box">
                <label>CREDITS</label>
                <div class="value" id="creditsValue">0</div>
            </div>
        </div>

        <div class="content">
            <div class="info-box">
                <p><strong>ðŸ“„ New:</strong> Upload your NSU grade sheet PDF to auto-fill courses! Or enter manually below.</p>
            </div>

            <div class="pdf-upload-section">
                <h2>ðŸ“¤ Upload Grade Sheet PDF</h2>
                <p>Drag & drop your NSU grade report PDF or click to browse</p>
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">ðŸ“„</div>
                    <div class="upload-text">Click to upload PDF</div>
                    <div class="upload-subtext">NSU grade sheet format supported</div>
                </div>
                <input type="file" id="pdfInput" accept=".pdf">
                <p style="margin-top: 15px; font-size: 12px; color: #666;">
                    <strong>Troubleshooting:</strong> Open browser Console (F12) to see extraction details
                </p>
            </div>

            <div class="form-section">
                <h2>ðŸ“š Course Entry</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Course</th>
                            <th>Credits</th>
                            <th>Grade</th>
                            <th>#</th>
                        </tr>
                    </thead>
                    <tbody id="courseBody">
                        <tr data-row="1">
                            <td><input type="text" placeholder="e.g., CSE115" class="course-name"></td>
                            <td>
                                <select class="course-credits">
                                    <option value="">-</option>
                                    <option value="0">0</option>
                                    <option value="1">1</option>
                                    <option value="1.5">1.5</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                </select>
                            </td>
                            <td>
                                <select class="course-grade">
                                    <option value="">-</option>
                                    <option value="4.0">A</option>
                                    <option value="3.7">A-</option>
                                    <option value="3.3">B+</option>
                                    <option value="3.0">B</option>
                                    <option value="2.7">B-</option>
                                    <option value="2.3">C+</option>
                                    <option value="2.0">C</option>
                                    <option value="1.7">C-</option>
                                    <option value="1.3">D+</option>
                                    <option value="1.0">D</option>
                                    <option value="0.0">F</option>
                                </select>
                            </td>
                            <td><button class="btn btn-remove" onclick="removeRow(1)">Remove</button></td>
                        </tr>
                    </tbody>
                </table>

                <div class="buttons">
                    <button class="btn btn-add" onclick="addRow()">+ Add Course</button>
                    <button class="btn btn-clear" onclick="clearAll()">Clear All</button>
                </div>
            </div>

            <div class="cta-box">
                <h3>ðŸŽ¯ Want to Plan Your Next Semester?</h3>
                <p>Use our CGPA Analyzer to calculate what grades you need to achieve your target CGPA!</p>
                <a href="analyzer.html" class="btn-analyze-link">Go to CGPA Analyzer â†’</a>
            </div>

            <div class="grading-table">
                <h2>ðŸ“Š North South University - Grading System</h2>
                <table>
                    <thead>
                        <tr><th>Scores</th><th>Grade</th><th>Points</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>93+</td><td><span class="grade-label">A</span> Excellent</td><td>4.0</td></tr>
                        <tr><td>90 - 92</td><td><span class="grade-label">A-</span></td><td>3.7</td></tr>
                        <tr><td>87 - 89</td><td><span class="grade-label">B+</span></td><td>3.3</td></tr>
                        <tr><td>83 - 86</td><td><span class="grade-label">B</span> Good</td><td>3.0</td></tr>
                        <tr><td>80 - 82</td><td><span class="grade-label">B-</span></td><td>2.7</td></tr>
                        <tr><td>77 - 79</td><td><span class="grade-label">C+</span></td><td>2.3</td></tr>
                        <tr><td>73 - 76</td><td><span class="grade-label">C</span> Average</td><td>2.0</td></tr>
                        <tr><td>70 - 72</td><td><span class="grade-label">C-</span></td><td>1.7</td></tr>
                        <tr><td>67 - 69</td><td><span class="grade-label">D+</span></td><td>1.3</td></tr>
                        <tr><td>60 - 66</td><td><span class="grade-label">D</span> Poor</td><td>1.0</td></tr>
                        <tr><td>Below 60</td><td><span class="grade-label">F</span> Failure</td><td>0.0</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="footer">
            NSU CGPA Calculator - Based on North South University Official Grading Policy
        </div>
    </div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        
        let rowCounter = 1;
        const gradeToPoints = {
            'A+': 4.0, 'A': 4.0, 'A-': 3.7, 
            'B+': 3.3, 'B': 3.0, 'B-': 2.7, 
            'C+': 2.3, 'C': 2.0, 'C-': 1.7, 
            'D+': 1.3, 'D': 1.0, 
            'F': 0.0
        };

        // PDF Upload
        document.getElementById('uploadArea').onclick = () => document.getElementById('pdfInput').click();
        document.getElementById('pdfInput').onchange = (e) => {
            if (e.target.files[0]) processPDF(e.target.files[0]);
        };

        async function processPDF(file) {
            try {
                alert('ðŸ“„ Reading PDF... Please wait.');
                
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                
                console.log('PDF loaded, pages:', pdf.numPages);
                
                let fullText = '';
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const textContent = await page.getTextContent();
                    fullText += textContent.items.map(item => item.str).join(' ') + '\n';
                }
                
                console.log('=== EXTRACTED TEXT START ===');
                console.log(fullText);
                console.log('=== EXTRACTED TEXT END ===');
                
                // Show extracted text in alert for easy copying
                const preview = fullText.substring(0, 500);
                const showFull = confirm(
                    'ðŸ“‹ PDF Text Preview (first 500 chars):\n\n' + preview + 
                    '\n\n...(more text)...\n\n' +
                    'Click OK to see full text in console, or Cancel to continue extraction.'
                );
                
                const courses = extractCourses(fullText);
                
                console.log('Found courses:', courses);
                
                if (courses.length > 0) {
                    populateCourses(courses);
                    alert(`âœ… Success! Found ${courses.length} courses!`);
                } else {
                    // Try to give helpful feedback
                    const hasCourseCodes = /[A-Z]{2,4}\d{2,4}/.test(fullText);
                    const hasGrades = /(A\+|A-|A|B\+|B-|B|C\+|C-|C|D\+|D|F)/i.test(fullText);
                    const hasCredits = /\d+\.?\d*/.test(fullText);
                    
                    let feedback = 'âš ï¸ No courses found.\n\n';
                    feedback += 'Detected in PDF:\n';
                    feedback += hasCourseCodes ? 'âœ… Course codes found\n' : 'âŒ No course codes (like CSE115)\n';
                    feedback += hasGrades ? 'âœ… Grades found\n' : 'âŒ No grades (A, B+, etc.)\n';
                    feedback += hasCredits ? 'âœ… Numbers found\n' : 'âŒ No credit numbers\n';
                    feedback += '\nðŸ“‹ Check Console (F12) to see extracted text.\n';
                    feedback += 'Copy it and send to developer for pattern fixing.\n\n';
                    feedback += 'Enter courses manually for now.';
                    
                    alert(feedback);
                }
            } catch (error) {
                console.error('PDF Error:', error);
                alert('âŒ Error reading PDF: ' + error.message + '\n\nPlease enter courses manually.');
            }
        }

        function extractCourses(text) {
            const courses = [];
            
            console.log('Starting extraction...');
            console.log('=== RAW TEXT ===');
            console.log(text);
            console.log('=== END RAW TEXT ===');
            
            // Clean and normalize text
            text = text.replace(/\s+/g, ' ').trim();
            
            // Multiple extraction strategies
            
            // Strategy 1: Table format with clear structure
            // Looking for: COURSECODE TITLE CREDITS GRADE GRADEPOINTS
            const tablePattern = /([A-Z]{2,5}\d{2,4})\s+([^0-9]{3,}?)\s+(\d+\.?\d*)\s+(A\+|A-|A|B\+|B-|B|C\+|C-|C|D\+|D|F)\s+(\d+\.?\d*)/gi;
            let match;
            
            while ((match = tablePattern.exec(text)) !== null) {
                const courseCode = match[1];
                const credits = parseFloat(match[3]);
                const grade = match[4].replace(/\s+/g, '');
                
                if (gradeToPoints[grade] !== undefined && credits > 0 && credits <= 10) {
                    console.log('Strategy 1 found:', courseCode, credits, grade);
                    courses.push({ name: courseCode, credits: credits, grade: gradeToPoints[grade] });
                }
            }
            
            // Strategy 2: Simpler pattern - just code, credits, grade
            if (courses.length === 0) {
                const simplePattern = /([A-Z]{2,5}\d{2,4})\s+.*?(\d+\.00|\d+)\s+(A\+|A-|A|B\+|B-|B|C\+|C-|C|D\+|D|F)/gi;
                
                while ((match = simplePattern.exec(text)) !== null) {
                    const courseCode = match[1];
                    const credits = parseFloat(match[2]);
                    const grade = match[3].replace(/\s+/g, '');
                    
                    if (gradeToPoints[grade] !== undefined && credits > 0 && credits <= 10) {
                        const isDuplicate = courses.some(c => c.name === courseCode);
                        if (!isDuplicate) {
                            console.log('Strategy 2 found:', courseCode, credits, grade);
                            courses.push({ name: courseCode, credits: credits, grade: gradeToPoints[grade] });
                        }
                    }
                }
            }
            
            // Strategy 3: Line by line parsing (for PDFs with weird spacing)
            if (courses.length === 0) {
                const lines = text.split(/\n|\r\n/);
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;
                    
                    // Look for course code
                    const codeMatch = line.match(/([A-Z]{2,5}\d{2,4})/);
                    if (!codeMatch) continue;
                    
                    const courseCode = codeMatch[1];
                    
                    // Look in this line and next few lines for credits and grade
                    const searchText = lines.slice(i, i + 5).join(' ');
                    const dataMatch = searchText.match(/(\d+\.?\d*)\s+(A\+|A-|A|B\+|B-|B|C\+|C-|C|D\+|D|F)/i);
                    
                    if (dataMatch) {
                        const credits = parseFloat(dataMatch[1]);
                        const grade = dataMatch[2].replace(/\s+/g, '');
                        
                        if (gradeToPoints[grade] !== undefined && credits > 0 && credits <= 10) {
                            const isDuplicate = courses.some(c => c.name === courseCode);
                            if (!isDuplicate) {
                                console.log('Strategy 3 found:', courseCode, credits, grade);
                                courses.push({ name: courseCode, credits: credits, grade: gradeToPoints[grade] });
                            }
                        }
                    }
                }
            }
            
            // Strategy 4: Split by spaces and look for sequences
            if (courses.length === 0) {
                const tokens = text.split(/\s+/);
                
                for (let i = 0; i < tokens.length - 10; i++) {
                    // Look for course code
                    if (/^[A-Z]{2,5}\d{2,4}$/.test(tokens[i])) {
                        const courseCode = tokens[i];
                        
                        // Look ahead for credits and grade
                        for (let j = i + 1; j < Math.min(i + 20, tokens.length - 1); j++) {
                            const credits = parseFloat(tokens[j]);
                            if (credits > 0 && credits <= 10) {
                                // Look for grade near credits
                                for (let k = j - 2; k < Math.min(j + 3, tokens.length); k++) {
                                    const grade = tokens[k].replace(/\s+/g, '');
                                    if (gradeToPoints[grade] !== undefined) {
                                        const isDuplicate = courses.some(c => c.name === courseCode);
                                        if (!isDuplicate) {
                                            console.log('Strategy 4 found:', courseCode, credits, grade);
                                            courses.push({ name: courseCode, credits: credits, grade: gradeToPoints[grade] });
                                            break;
                                        }
                                    }
                                }
                                break;
                            }
                        }
                    }
                }
            }
            
            console.log('Total courses found:', courses.length);
            console.log('Courses:', courses);
            
            return courses;
        }

        function populateCourses(courses) {
            const tbody = document.getElementById('courseBody');
            tbody.innerHTML = '';
            courses.forEach((course, index) => {
                const row = document.createElement('tr');
                row.setAttribute('data-row', index + 1);
                row.innerHTML = `
                    <td><input type="text" class="course-name" value="${course.name}"></td>
                    <td><select class="course-credits">
                        <option value="">-</option>
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="1.5">1.5</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                    </select></td>
                    <td><select class="course-grade">
                        <option value="">-</option>
                        <option value="4.0">A</option>
                        <option value="3.7">A-</option>
                        <option value="3.3">B+</option>
                        <option value="3.0">B</option>
                        <option value="2.7">B-</option>
                        <option value="2.3">C+</option>
                        <option value="2.0">C</option>
                        <option value="1.7">C-</option>
                        <option value="1.3">D+</option>
                        <option value="1.0">D</option>
                        <option value="0.0">F</option>
                    </select></td>
                    <td><button class="btn btn-remove" onclick="removeRow(${index + 1})">Remove</button></td>
                `;
                tbody.appendChild(row);
                row.querySelector('.course-credits').value = course.credits;
                row.querySelector('.course-grade').value = course.grade;
                attachEventListeners(row);
            });
            rowCounter = courses.length;
            calculateCGPA();
            saveData();
        }

        function addRow() {
            rowCounter++;
            const tbody = document.getElementById('courseBody');
            const newRow = document.createElement('tr');
            newRow.setAttribute('data-row', rowCounter);
            newRow.innerHTML = `
                <td><input type="text" placeholder="e.g., CSE115" class="course-name"></td>
                <td>
                    <select class="course-credits">
                        <option value="">-</option>
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="1.5">1.5</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                    </select>
                </td>
                <td>
                    <select class="course-grade">
                        <option value="">-</option>
                        <option value="4.0">A</option>
                        <option value="3.7">A-</option>
                        <option value="3.3">B+</option>
                        <option value="3.0">B</option>
                        <option value="2.7">B-</option>
                        <option value="2.3">C+</option>
                        <option value="2.0">C</option>
                        <option value="1.7">C-</option>
                        <option value="1.3">D+</option>
                        <option value="1.0">D</option>
                        <option value="0.0">F</option>
                    </select>
                </td>
                <td><button class="btn btn-remove" onclick="removeRow(${rowCounter})">Remove</button></td>
            `;
            tbody.appendChild(newRow);
            attachEventListeners(newRow);
            saveData();
        }

        function removeRow(rowNum) {
            const rows = document.querySelectorAll('#courseBody tr');
            if (rows.length > 1) {
                const row = document.querySelector(`tr[data-row="${rowNum}"]`);
                if (row) {
                    row.remove();
                    calculateCGPA();
                    saveData();
                }
            } else {
                alert('You must have at least one course row!');
            }
        }

        function clearAll() {
            if (confirm('Are you sure you want to clear all courses?')) {
                const tbody = document.getElementById('courseBody');
                tbody.innerHTML = `
                    <tr data-row="1">
                        <td><input type="text" placeholder="e.g., CSE115" class="course-name"></td>
                        <td>
                            <select class="course-credits">
                                <option value="">-</option>
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="1.5">1.5</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                            </select>
                        </td>
                        <td>
                            <select class="course-grade">
                                <option value="">-</option>
                                <option value="4.0">A</option>
                                <option value="3.7">A-</option>
                                <option value="3.3">B+</option>
                                <option value="3.0">B</option>
                                <option value="2.7">B-</option>
                                <option value="2.3">C+</option>
                                <option value="2.0">C</option>
                                <option value="1.7">C-</option>
                                <option value="1.3">D+</option>
                                <option value="1.0">D</option>
                                <option value="0.0">F</option>
                            </select>
                        </td>
                        <td><button class="btn btn-remove" onclick="removeRow(1)">Remove</button></td>
                    </tr>
                `;
                rowCounter = 1;
                attachEventListeners(tbody.querySelector('tr'));
                calculateCGPA();
                saveData();
            }
        }

        function calculateCGPA() {
            const rows = document.querySelectorAll('#courseBody tr');
            let totalPoints = 0;
            let totalCredits = 0;

            rows.forEach(row => {
                const credits = parseFloat(row.querySelector('.course-credits').value);
                const grade = parseFloat(row.querySelector('.course-grade').value);

                if (credits && !isNaN(grade)) {
                    totalPoints += credits * grade;
                    totalCredits += credits;
                }
            });

            const cgpa = totalCredits > 0 ? (totalPoints / totalCredits) : 0;
            document.getElementById('cgpaValue').textContent = cgpa.toFixed(2);
            document.getElementById('creditsValue').textContent = totalCredits.toFixed(1);

            localStorage.setItem('calculatorCGPA', cgpa.toFixed(2));
            localStorage.setItem('calculatorCredits', totalCredits.toFixed(1));
        }

        function attachEventListeners(row) {
            const inputs = row.querySelectorAll('input, select');
            inputs.forEach(input => {
                input.addEventListener('change', () => {
                    calculateCGPA();
                    saveData();
                });
                input.addEventListener('input', () => {
                    saveData();
                });
            });
        }

        function saveData() {
            const rows = document.querySelectorAll('#courseBody tr');
            const data = [];
            
            rows.forEach(row => {
                data.push({
                    name: row.querySelector('.course-name').value,
                    credits: row.querySelector('.course-credits').value,
                    grade: row.querySelector('.course-grade').value
                });
            });

            localStorage.setItem('nsuCgpaData', JSON.stringify(data));
        }

        function loadData() {
            const saved = localStorage.getItem('nsuCgpaData');
            if (saved) {
                const data = JSON.parse(saved);
                const tbody = document.getElementById('courseBody');
                tbody.innerHTML = '';

                data.forEach((course, index) => {
                    const rowNum = index + 1;
                    const newRow = document.createElement('tr');
                    newRow.setAttribute('data-row', rowNum);
                    newRow.innerHTML = `
                        <td><input type="text" placeholder="e.g., CSE115" class="course-name" value="${course.name}"></td>
                        <td>
                            <select class="course-credits">
                                <option value="">-</option>
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="1.5">1.5</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                            </select>
                        </td>
                        <td>
                            <select class="course-grade">
                                <option value="">-</option>
                                <option value="4.0">A</option>
                                <option value="3.7">A-</option>
                                <option value="3.3">B+</option>
                                <option value="3.0">B</option>
                                <option value="2.7">B-</option>
                                <option value="2.3">C+</option>
                                <option value="2.0">C</option>
                                <option value="1.7">C-</option>
                                <option value="1.3">D+</option>
                                <option value="1.0">D</option>
                                <option value="0.0">F</option>
                            </select>
                        </td>
                        <td><button class="btn btn-remove" onclick="removeRow(${rowNum})">Remove</button></td>
                    `;
                    tbody.appendChild(newRow);
                    
                    newRow.querySelector('.course-credits').value = course.credits;
                    newRow.querySelector('.course-grade').value = course.grade;
                    
                    attachEventListeners(newRow);
                });

                rowCounter = data.length;
                calculateCGPA();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            const initialRow = document.querySelector('#courseBody tr');
            if (initialRow) {
                attachEventListeners(initialRow);
            }
        });
    </script>
</body>
</html>